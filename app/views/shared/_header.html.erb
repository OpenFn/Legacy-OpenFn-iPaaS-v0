<nav class="navbar navbar-default navbar-fixed-top" role="navigation" ng-init="isCollapsed = true">
<div class="top-shadow hidden-xs"></div>
<!-- <div class="top-shadow-mobile"></div> -->
  <div class="container">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" ng-click="isCollapsed = !isCollapsed">
        <span class="sr-only">Toggle navigation</span><i class="fa fa-bars" style="color: #3f5666"></i>
      </button>
      <a class="navbar-brand" href="/">open[Fn]</a>
    </div>
    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="navbar-collapse collapse" collapse="isCollapsed">
      <ul class="nav navbar-nav">
        <li>
          <%= link_to "Marketplace", "/#/marketplace"%>
        </li>
        <li>
          <%= link_to "Integrations", odk_sf_legacy_mappings_path, 'ng-click' => "$event.stopPropagation()" %>
        </li>
        <li>
          <%= link_to "Content", "/#/release-notes"%>
        </li>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false"> More <span class="caret"></span></a>
            <ul class="dropdown-menu" role="menu">
              <% unless current_user %>
                <li>
                  <%= link_to "Pricing", "/#/pricing" %>
                </li>
              <% end %>
              <li>
                <%= link_to "Developers", "/#/developers"%>
              </li>
            </ul>
        </li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <% if current_user %>
          <li class="dropdown">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false"><%= current_user.email %> <span class="caret"></span></a>
            <ul class="dropdown-menu" role="menu">
              <li>
                <%= link_to edit_user_path(current_user), 'ng-click' => "$event.stopPropagation()" do %>
                  Settings
                <% end %>
              </li>
              <li>
                <a href="#">Connected Apps (soon)</a>
              </li>
              <li class="divider"></li>
              <li>
                <%= link_to "/logout", method: :post do %>
                  Log out
                <% end %>
              </li>
            </ul>
          </li>
        <% end %>

        <% unless current_user %>
          <li>
            <%= link_to "/login", method: :get do %>
              Log in
            <% end %>
          </li>
          <li>
            <%= link_to "/signup", method: :get do %>
              <button type="button" class="btn btn-success">Sign up</button>
            <% end %>
          </li>
          <li>
            
              <button style="margin-top: 1.1em; margin-left: .75em;" type="button" data-toggle="modal" data-target="#donate_modal" class="btn btn-danger">Donate</button>
            
        <% end %>

    </div>
</nav>
<%if current_user && current_user.client_admin?%>
  <%= render 'shared/invite_modal'%>
  <%= render 'shared/confirm_modal'%>
<%end%>

<div class="ideas">
  <div class="modal fade" id="donate_modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="featurette dark">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title center" id="myModalLabel">Make a donation.</h4>
          </div>
          <div class="modal-body">          
            <strong>Thanks so much for your support</strong>. Before you continue, there are a couple of things you should know about this project.
            <br>
            <br>
            OpenFn is a registered non-profit, but our <strong>501(c)3 application is pending</strong>.
            <br>
            <br>
            We believe that we'll receive our 501(c)3 approval in this tax year, 2015, but if the IRS ultimately rejects our application, then your donation will not be tax-deductible. To learn more, click <a href="http://www.irs.gov/Charities-&-Non-Profits/Charitable-Organizations/Contributions-to-Organization-with-IRS-Application-Pending" target="_blank">here.</a>
            <br>
            <br>
            To make a donation, select your desired amount below and enter your credit card details on the following page.
            <br>
            <br>
            <br>
            <div class="row center">
              <div class="col-sm-2 col-sm-offset-3">
                <button class="btn btn-donate" id="d10"><span class="mb-title">$10</span></button>
              </div>
              <div class="col-sm-2">
                <button class="btn btn-donate" id="d25"><span class="mb-title">$25</span></button>
              </div>
              <div class="col-sm-2">
                <button class="btn btn-donate" id="d50"><span class="mb-title">$50</span></button>
              </div>
            </div>
            <br>
            <div class="row center">
              <div class="col-sm-2 col-sm-offset-3">
                <button class="btn btn-donate" id="d100"><span class="mb-title">$100</span></button>
              </div>
              <div class="col-sm-2">
                <button class="btn btn-donate" id="d200"><span class="mb-title">$200</span></button>
              </div>
              <div class="col-sm-2">
                <button class="btn btn-donate" id="d300"><span class="mb-title">$300</span></button>
              </div>
            </div>
            <br>
            <div class="row center">
              <div class="col-sm-2 col-sm-offset-3">
                <button class="btn btn-donate" id="d1k"><span class="mb-title">$1000</span></button>
              </div>
              <div class="col-sm-4">
                <div class="input-group">
                  <span class="input-group-addon">$</span>
                  <input type="text" class="form-control" style="height: 2.8em;" aria-label="Amount (to the nearest dollar)" id="custom-donation-amount" placeholder="Custom">
                  <span class="input-group-btn">
                    <button class="btn btn-donate" type="button" id="customButton"><span class="mb-title">Go</span></button>
                  </span>
                </div>
              </div>
            </div>
            <br>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script src="https://checkout.stripe.com/checkout.js"></script>

<script>
  var handler = StripeCheckout.configure({
    key: 'pk_test_W9FR29OKTtcmeAftxYCHtEM2',
    name: 'open[Fn]',
    panelLabel: "Donate {{amount}}",
    description: 'One-time donation to open[Fn]',
    token: function(token) {
      // Use the token to create the charge with a server-side script.
      // You can access the token ID with `token.id`
    }
  });

  $('#d10').on('click', function(e) {
    // Open Checkout with further options
    handler.open({
      amount: 1000
    });
    e.preventDefault();
  });

  $('#d25').on('click', function(e) {
    // Open Checkout with further options
    handler.open({
      amount: 2500
    });
    e.preventDefault();
  });

  $('#d50').on('click', function(e) {
    // Open Checkout with further options
    handler.open({
      amount: 5000
    });
    e.preventDefault();
  });

  $('#d100').on('click', function(e) {
    // Open Checkout with further options
    handler.open({
      amount: 10000
    });
    e.preventDefault();
  });

  $('#d200').on('click', function(e) {
    // Open Checkout with further options
    handler.open({
      amount: 20000
    });
    e.preventDefault();
  });

  $('#d300').on('click', function(e) {
    // Open Checkout with further options
    handler.open({
      amount: 30000
    });
    e.preventDefault();
  });

  $('#d1k').on('click', function(e) {
    // Open Checkout with further options
    handler.open({
      amount: 100000
    });
    e.preventDefault();
  });

    $('#customButton').on('click', function(e) {
    // Open Checkout with further options
    var amount = $("#custom-donation-amount").val() * 100;
    handler.open({
      amount: amount
    });
    e.preventDefault();
  });

  // Close Checkout on page navigation
  $(window).on('popstate', function() {
    handler.close();
  });
</script>